"0","apartment_size_median <- quantile(apartment$living_square_feet_all_buildings/apartment$number_of_units,0.5, na.rm=T)"
"0","apartment_bed_median <- quantile(apartment$bedrooms_all_buildings/apartment$number_of_units,0.5, na.rm=T)"
"0","apartment_unit_median <- quantile(apartment$number_of_units,0.5, na.rm=T)"
"0",""
"0","# Adjust NA sets"
"0",""
"0",""
"0","summary(apartment$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","   1.00 "
"1","   5.00 "
"1","   8.00 "
"1","  14.41 "
"1","  12.00 "
"1","1745.00 "
"1","  11737 "
"1","
"
"0","apartment_adj <- apartment %>%"
"0","  mutate(adjustment_note=ifelse(is.na(number_of_units),"
"0","                                ""Missing unit, assign median"",""Original"")) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, assign median"","
"0","                                floor(apartment_unit_median),number_of_units))"
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(adjustment_note==""Missing unit, assign median"" & !is.na(bedrooms_all_buildings),"
"0","                                ""Missing unit, infer from bedroom"",adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, infer from bedroom"","
"0","                                ceiling(bedrooms_all_buildings/apartment_bed_median),number_of_units))"
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(adjustment_note==""Missing unit, assign median"" & !is.na(living_square_feet_all_buildings),"
"0","                                ""Missing unit, infer from living space"",adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, infer from living space"","
"0","                                ceiling(living_square_feet_all_buildings/apartment_size_median),number_of_units))"
"0",""
"0","tab1(apartment_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","apartment_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","     83100"
"1","    87.6"
"1","         87.6"
"1","
Missing unit, infer from living space"
"1","      7128"
"1","     7.5"
"1","         95.1"
"1","
Missing unit, infer from bedroom     "
"1","      2409"
"1","     2.5"
"1","         97.7"
"1","
Missing unit, assign median          "
"1","      2200"
"1","     2.3"
"1","        100.0"
"1","
  Total                              "
"1","     94837"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(apartment_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   5.00 "
"1","   7.00 "
"1","  13.44 "
"1","  11.00 "
"1","1745.00 "
"1","
"
"0","# Adjust upper outliers"
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note= ifelse(living_square_feet_all_buildings/number_of_units> 3000,"
"0","                                 ""Upper outlier, cap living space"", adjustment_note) %>% "
"0","           ifelse(!is.na(living_square_feet_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Upper outlier, cap living space"","
"0","                                ceiling(living_square_feet_all_buildings/3000),number_of_units))"
"0",""
"0",""
"0","tab1(apartment_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","apartment_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","     81961"
"1","    86.4"
"1","         86.4"
"1","
Missing unit, infer from living space"
"1","      7128"
"1","     7.5"
"1","         93.9"
"1","
Missing unit, infer from bedroom     "
"1","      2393"
"1","     2.5"
"1","         96.5"
"1","
Missing unit, assign median          "
"1","      2200"
"1","     2.3"
"1","         98.8"
"1","
Upper outlier, cap living space      "
"1","      1155"
"1","     1.2"
"1","        100.0"
"1","
  Total                              "
"1","     94837"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(apartment_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   5.00 "
"1","   7.00 "
"1","  13.59 "
"1","  12.00 "
"1","1745.00 "
"1","
"
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(bedrooms_all_buildings/number_of_units >= 4,"
"0","                                ""Upper outlier, cap bedroom"",adjustment_note) %>% "
"0","           ifelse(!is.na(bedrooms_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Upper outlier, cap bedroom"","
"0","                                ceiling(bedrooms_all_buildings/apartment_bed_median),number_of_units))  "
"0",""
"0",""
"0","tab1(apartment_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","apartment_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","     80884"
"1","    85.3"
"1","         85.3"
"1","
Missing unit, infer from living space"
"1","      7128"
"1","     7.5"
"1","         92.8"
"1","
Missing unit, infer from bedroom     "
"1","      2393"
"1","     2.5"
"1","         95.3"
"1","
Missing unit, assign median          "
"1","      2200"
"1","     2.3"
"1","         97.6"
"1","
Upper outlier, cap bedroom           "
"1","      1578"
"1","     1.7"
"1","         99.3"
"1","
Upper outlier, cap living space      "
"1","       654"
"1","     0.7"
"1","        100.0"
"1","
  Total                              "
"1","     94837"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(apartment_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   5.00 "
"1","   7.00 "
"1","  13.89 "
"1","  12.00 "
"1","1745.00 "
"1","
"
"0","# Adjust lower outliers "
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(living_square_feet_all_buildings/number_of_units < 200,"
"0","                                ""Lower outlier, cap living space"",adjustment_note) %>% "
"0","           ifelse(!is.na(living_square_feet_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Lower outlier, cap living space"","
"0","                                floor(living_square_feet_all_buildings/200),number_of_units))"
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(bedrooms_all_buildings/number_of_units < 1,"
"0","                                ""Lower outlier, cap bedroom"",adjustment_note)%>% "
"0","           ifelse(!is.na(bedrooms_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Lower outlier, cap bedroom"","
"0","                                bedrooms_all_buildings,number_of_units))  "
"0",""
"0","apartment_adj %<>%"
"0","  mutate(number_of_units=ifelse(number_of_units==0,"
"0","                                1,number_of_units))"
"0",""
"0","tab1(apartment_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","apartment_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","     72655"
"1","    76.6"
"1","         76.6"
"1","
Lower outlier, cap bedroom           "
"1","      7835"
"1","     8.3"
"1","         84.9"
"1","
Missing unit, infer from living space"
"1","      7126"
"1","     7.5"
"1","         92.4"
"1","
Missing unit, infer from bedroom     "
"1","      2368"
"1","     2.5"
"1","         94.9"
"1","
Missing unit, assign median          "
"1","      2200"
"1","     2.3"
"1","         97.2"
"1","
Upper outlier, cap bedroom           "
"1","      1558"
"1","     1.6"
"1","         98.8"
"1","
Upper outlier, cap living space      "
"1","       586"
"1","     0.6"
"1","         99.5"
"1","
Lower outlier, cap living space      "
"1","       509"
"1","     0.5"
"1","        100.0"
"1","
  Total                              "
"1","     94837"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(apartment_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   5.00 "
"1","   7.00 "
"1","  12.48 "
"1","  11.00 "
"1"," 913.00 "
"1","
"
"0","apartment_adj <- data.frame(lapply(apartment_adj,rep,apartment_adj$number_of_units)) %>%"
"0","  mutate(assessed_total_value=assessed_total_value/number_of_units,"
"0","         assessed_land_value=assessed_land_value/number_of_units,"
"0","         assessed_improvement_value=assessed_improvement_value/number_of_units,"
"0","         land_square_footage=land_square_footage/number_of_units,"
"0","         bedrooms_all_buildings=bedrooms_all_buildings/number_of_units,"
"0","         living_square_feet_all_buildings=living_square_feet_all_buildings/number_of_units)"
