"0","duplex_size_median <- quantile(duplex$living_square_feet_all_buildings/duplex$number_of_units,0.5, na.rm=T)"
"0","duplex_bed_median <- quantile(duplex$bedrooms_all_buildings/duplex$number_of_units,0.5, na.rm=T)"
"0","duplex_unit_median <- quantile(duplex$number_of_units,0.5, na.rm=T)"
"0",""
"0","# Adjust NA sets"
"0",""
"0",""
"0","summary(duplex$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","  1.000 "
"1","  2.000 "
"1","  2.000 "
"1","  2.604 "
"1","  3.000 "
"1","502.000 "
"1","   2132 "
"1","
"
"0","duplex_adj <- duplex %>%"
"0","  mutate(adjustment_note=ifelse(is.na(number_of_units),"
"0","                                ""Missing unit, assign median"",""Original"")) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, assign median"","
"0","                                floor(duplex_unit_median),number_of_units))"
"0",""
"0","duplex_adj %<>%"
"0","  mutate(adjustment_note=ifelse(adjustment_note==""Missing unit, assign median"" & !is.na(bedrooms_all_buildings),"
"0","                                ""Missing unit, infer from bedroom"",adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, infer from bedroom"","
"0","                                ceiling(bedrooms_all_buildings/duplex_bed_median),number_of_units))"
"0",""
"0","duplex_adj %<>%"
"0","  mutate(adjustment_note=ifelse(adjustment_note==""Missing unit, assign median"" & !is.na(living_square_feet_all_buildings),"
"0","                                ""Missing unit, infer from living space"",adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, infer from living space"","
"0","                                ceiling(living_square_feet_all_buildings/duplex_size_median),number_of_units))"
"0",""
"0","tab1(duplex_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","duplex_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","    175023"
"1","    98.8"
"1","         98.8"
"1","
Missing unit, assign median          "
"1","      1776"
"1","     1.0"
"1","         99.8"
"1","
Missing unit, infer from living space"
"1","       206"
"1","     0.1"
"1","         99.9"
"1","
Missing unit, infer from bedroom     "
"1","       150"
"1","     0.1"
"1","        100.0"
"1","
  Total                              "
"1","    177155"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(duplex_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  1.000 "
"1","  2.000 "
"1","  2.000 "
"1","  2.599 "
"1","  3.000 "
"1","502.000 "
"1","
"
"0","# Adjust upper outliers"
"0",""
"0","duplex_adj %<>%"
"0","  mutate(adjustment_note= ifelse(living_square_feet_all_buildings/number_of_units> 5000,"
"0","                                 ""Upper outlier, cap living space"", adjustment_note) %>% "
"0","           ifelse(!is.na(living_square_feet_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Upper outlier, cap living space"","
"0","                                ceiling(living_square_feet_all_buildings/5000),number_of_units))"
"0",""
"0",""
"0","tab1(duplex_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","duplex_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","    174980"
"1","    98.8"
"1","         98.8"
"1","
Missing unit, assign median          "
"1","      1776"
"1","     1.0"
"1","         99.8"
"1","
Missing unit, infer from living space"
"1","       206"
"1","     0.1"
"1","         99.9"
"1","
Missing unit, infer from bedroom     "
"1","       150"
"1","     0.1"
"1","        100.0"
"1","
Upper outlier, cap living space      "
"1","        43"
"1","     0.0"
"1","        100.0"
"1","
  Total                              "
"1","    177155"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(duplex_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  1.000 "
"1","  2.000 "
"1","  2.000 "
"1","  2.599 "
"1","  3.000 "
"1","502.000 "
"1","
"
"0","duplex_adj %<>%"
"0","  mutate(adjustment_note=ifelse(bedrooms_all_buildings/number_of_units >= 4,"
"0","                                ""Upper outlier, cap bedroom"",adjustment_note) %>% "
"0","           ifelse(!is.na(bedrooms_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Upper outlier, cap bedroom"","
"0","                                ceiling(bedrooms_all_buildings/duplex_bed_median),number_of_units))  "
"0",""
"0",""
"0","tab1(duplex_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","duplex_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","    171694"
"1","    96.9"
"1","         96.9"
"1","
Upper outlier, cap bedroom           "
"1","      3289"
"1","     1.9"
"1","         98.8"
"1","
Missing unit, assign median          "
"1","      1776"
"1","     1.0"
"1","         99.8"
"1","
Missing unit, infer from living space"
"1","       206"
"1","     0.1"
"1","         99.9"
"1","
Missing unit, infer from bedroom     "
"1","       150"
"1","     0.1"
"1","        100.0"
"1","
Upper outlier, cap living space      "
"1","        40"
"1","     0.0"
"1","        100.0"
"1","
  Total                              "
"1","    177155"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(duplex_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  1.000 "
"1","  2.000 "
"1","  2.000 "
"1","  2.642 "
"1","  3.000 "
"1","502.000 "
"1","
"
"0","# Adjust lower outliers "
"0",""
"0","duplex_adj %<>%"
"0","  mutate(adjustment_note=ifelse(living_square_feet_all_buildings/number_of_units < 400,"
"0","                                ""Lower outlier, cap living space"",adjustment_note) %>% "
"0","           ifelse(!is.na(living_square_feet_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Lower outlier, cap living space"","
"0","                                floor(living_square_feet_all_buildings/400),number_of_units))"
"0","  "
"0",""
"0","duplex_adj %<>%"
"0","  mutate(adjustment_note=ifelse(bedrooms_all_buildings/number_of_units < 1,"
"0","                                ""Lower outlier, cap bedroom"",adjustment_note)%>% "
"0","           ifelse(!is.na(bedrooms_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Lower outlier, cap bedroom"","
"0","                                bedrooms_all_buildings,number_of_units))  "
"0",""
"0","duplex_adj %<>%"
"0","  mutate(number_of_units=ifelse(number_of_units==0,"
"0","                                1,number_of_units))"
"0",""
"0","tab1(duplex_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","duplex_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","    168125"
"1","    94.9"
"1","         94.9"
"1","
Upper outlier, cap bedroom           "
"1","      3252"
"1","     1.8"
"1","         96.7"
"1","
Lower outlier, cap bedroom           "
"1","      2817"
"1","     1.6"
"1","         98.3"
"1","
Missing unit, assign median          "
"1","      1776"
"1","     1.0"
"1","         99.3"
"1","
Lower outlier, cap living space      "
"1","       796"
"1","     0.4"
"1","         99.8"
"1","
Missing unit, infer from living space"
"1","       206"
"1","     0.1"
"1","         99.9"
"1","
Missing unit, infer from bedroom     "
"1","       150"
"1","     0.1"
"1","        100.0"
"1","
Upper outlier, cap living space      "
"1","        33"
"1","     0.0"
"1","        100.0"
"1","
  Total                              "
"1","    177155"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(duplex_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  1.000 "
"1","  2.000 "
"1","  2.000 "
"1","  2.599 "
"1","  3.000 "
"1"," 62.000 "
"1","
"
"0","duplex_adj <- data.frame(lapply(duplex_adj,rep,duplex_adj$number_of_units)) %>%"
"0","  mutate(assessed_total_value=assessed_total_value/number_of_units,"
"0","         assessed_land_value=assessed_land_value/number_of_units,"
"0","         assessed_improvement_value=assessed_improvement_value/number_of_units,"
"0","         land_square_footage=land_square_footage/number_of_units,"
"0","         bedrooms_all_buildings=bedrooms_all_buildings/number_of_units,"
"0","         living_square_feet_all_buildings=living_square_feet_all_buildings/number_of_units)"
"0",""
