"0","apartment_size_median <- quantile(apartment$living_square_feet_all_buildings/apartment$number_of_units,0.5, na.rm=T)"
"0","apartment_bed_median <- quantile(apartment$bedrooms_all_buildings/apartment$number_of_units,0.5, na.rm=T)"
"0","apartment_unit_median <- quantile(apartment$number_of_units,0.5, na.rm=T)"
"0",""
"0","# Adjust NA sets"
"0",""
"0",""
"0","summary(apartment$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","   1.00 "
"1","   5.00 "
"1","   8.00 "
"1","  17.64 "
"1","  12.00 "
"1","1745.00 "
"1","  28829 "
"1","
"
"0","apartment_adj <- apartment %>%"
"0","  mutate(adjustment_note=ifelse(is.na(number_of_units),"
"0","                                ""Missing unit, assign median"",""Original"")) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, assign median"","
"0","                                floor(apartment_unit_median),number_of_units))"
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(adjustment_note==""Missing unit, assign median"" & !is.na(bedrooms_all_buildings),"
"0","                                ""Missing unit, infer from bedroom"",adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, infer from bedroom"","
"0","                                ceiling(bedrooms_all_buildings/apartment_bed_median),number_of_units))"
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(adjustment_note==""Missing unit, assign median"" & !is.na(living_square_feet_all_buildings),"
"0","                                ""Missing unit, infer from living space"",adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Missing unit, infer from living space"","
"0","                                ceiling(living_square_feet_all_buildings/apartment_size_median),number_of_units))"
"0",""
"0","tab1(apartment_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","apartment_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","     91796"
"1","    76.1"
"1","         76.1"
"1","
Missing unit, assign median          "
"1","     11189"
"1","     9.3"
"1","         85.4"
"1","
Missing unit, infer from bedroom     "
"1","      9874"
"1","     8.2"
"1","         93.6"
"1","
Missing unit, infer from living space"
"1","      7766"
"1","     6.4"
"1","        100.0"
"1","
  Total                              "
"1","    120625"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(apartment_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   4.00 "
"1","   7.00 "
"1","  15.01 "
"1","  10.00 "
"1","1745.00 "
"1","
"
"0","# Adjust upper outliers"
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note= ifelse(living_square_feet_all_buildings/number_of_units> 3000,"
"0","                                 ""Upper outlier, cap living space"", adjustment_note) %>% "
"0","           ifelse(!is.na(living_square_feet_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Upper outlier, cap living space"","
"0","                                ceiling(living_square_feet_all_buildings/3000),number_of_units))"
"0",""
"0",""
"0","tab1(apartment_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","apartment_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","     90474"
"1","    75.0"
"1","         75.0"
"1","
Missing unit, assign median          "
"1","     11189"
"1","     9.3"
"1","         84.3"
"1","
Missing unit, infer from bedroom     "
"1","      9852"
"1","     8.2"
"1","         92.4"
"1","
Missing unit, infer from living space"
"1","      7766"
"1","     6.4"
"1","         98.9"
"1","
Upper outlier, cap living space      "
"1","      1344"
"1","     1.1"
"1","        100.0"
"1","
  Total                              "
"1","    120625"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(apartment_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   5.00 "
"1","   7.00 "
"1","  15.14 "
"1","  10.00 "
"1","1745.00 "
"1","
"
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(bedrooms_all_buildings/number_of_units >= 4,"
"0","                                ""Upper outlier, cap bedroom"",adjustment_note) %>% "
"0","           ifelse(!is.na(bedrooms_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Upper outlier, cap bedroom"","
"0","                                ceiling(bedrooms_all_buildings/apartment_bed_median),number_of_units))  "
"0",""
"0",""
"0","tab1(apartment_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","apartment_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","     89375"
"1","    74.1"
"1","         74.1"
"1","
Missing unit, assign median          "
"1","     11189"
"1","     9.3"
"1","         83.4"
"1","
Missing unit, infer from bedroom     "
"1","      9852"
"1","     8.2"
"1","         91.5"
"1","
Missing unit, infer from living space"
"1","      7766"
"1","     6.4"
"1","         98.0"
"1","
Upper outlier, cap bedroom           "
"1","      1602"
"1","     1.3"
"1","         99.3"
"1","
Upper outlier, cap living space      "
"1","       841"
"1","     0.7"
"1","        100.0"
"1","
  Total                              "
"1","    120625"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(apartment_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   5.00 "
"1","   7.00 "
"1","  15.38 "
"1","  10.00 "
"1","1745.00 "
"1","
"
"0","# Adjust lower outliers "
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(living_square_feet_all_buildings/number_of_units < 200,"
"0","                                ""Lower outlier, cap living space"",adjustment_note) %>% "
"0","           ifelse(!is.na(living_square_feet_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Lower outlier, cap living space"","
"0","                                floor(living_square_feet_all_buildings/200),number_of_units))"
"0",""
"0","apartment_adj %<>%"
"0","  mutate(adjustment_note=ifelse(bedrooms_all_buildings/number_of_units < 1,"
"0","                                ""Lower outlier, cap bedroom"",adjustment_note)%>% "
"0","           ifelse(!is.na(bedrooms_all_buildings/number_of_units), .,adjustment_note)) %>%"
"0","  mutate(number_of_units=ifelse(adjustment_note==""Lower outlier, cap bedroom"","
"0","                                bedrooms_all_buildings,number_of_units))  "
"0",""
"0","apartment_adj %<>%"
"0","  mutate(number_of_units=ifelse(number_of_units==0,"
"0","                                1,number_of_units))"
"0",""
"0","tab1(apartment_adj$adjustment_note, sort.group = ""decreasing"", cum.percent = TRUE, graph = F)"
"1","apartment_adj$adjustment_note : 
"
"1","                                     "
"1"," Frequency"
"1"," Percent"
"1"," Cum. percent"
"1","
Original                             "
"1","     80349"
"1","    66.6"
"1","         66.6"
"1","
Missing unit, assign median          "
"1","     11189"
"1","     9.3"
"1","         75.9"
"1","
Missing unit, infer from bedroom     "
"1","      9824"
"1","     8.1"
"1","         84.0"
"1","
Lower outlier, cap bedroom           "
"1","      8574"
"1","     7.1"
"1","         91.1"
"1","
Missing unit, infer from living space"
"1","      7764"
"1","     6.4"
"1","         97.6"
"1","
Upper outlier, cap bedroom           "
"1","      1582"
"1","     1.3"
"1","         98.9"
"1","
Upper outlier, cap living space      "
"1","       769"
"1","     0.6"
"1","         99.5"
"1","
Lower outlier, cap living space      "
"1","       574"
"1","     0.5"
"1","        100.0"
"1","
  Total                              "
"1","    120625"
"1","   100.0"
"1","        100.0"
"1","
"
"0","summary(apartment_adj$number_of_units)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   4.00 "
"1","   7.00 "
"1","  12.49 "
"1","  10.00 "
"1"," 913.00 "
"1","
"
"0","apartment_adj <- data.frame(lapply(apartment_adj,rep,apartment_adj$number_of_units)) %>%"
"0","  mutate(assessed_total_value=assessed_total_value/number_of_units,"
"0","         assessed_land_value=assessed_land_value/number_of_units,"
"0","         assessed_improvement_value=assessed_improvement_value/number_of_units,"
"0","         land_square_footage=land_square_footage/number_of_units,"
"0","         bedrooms_all_buildings=bedrooms_all_buildings/number_of_units,"
"0","         living_square_feet_all_buildings=living_square_feet_all_buildings/number_of_units)"
